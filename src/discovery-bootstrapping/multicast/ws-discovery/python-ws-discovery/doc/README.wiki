= python-ws-discovery =

This directory contains an application of WS-Discovery for bootstrapping Arrowhead service discovery. It uses a third party library licensed by Andrei Kopats, Pieter Jordaan and L.A. Fernando.

= Usage =

== Two local containers ==

[Optional] Remove the Docker networks.

<pre>docker network rm mcast_net</pre>
[Optional] Create the networks.

<pre>docker network create \
            -d macvlan \
            --subnet=192.168.0.0/24 \
            --gateway=192.168.0.1 \
            -o parent=wlp58s0 \
            mcast_net</pre>
Build the images.

<pre>docker build --tag python-ws-discovery-server core/
docker build --tag python-ws-discovery-client client/</pre>
[Optional] Disable packet forwarding.

<pre>sudo sysctl net.ipv4.conf.all.forwarding=0</pre>
Run the containers.

<pre>SERVER_ADDRESS=127.0.0.1
[ -n &quot;SERVER_ADDRESS&quot; ] &amp;&amp; \
docker run \
       --rm \
       --network mcast_net \
       --ip 192.168.0.121 \
       --env SERVICE_TYPE=&quot;http&quot; \
       --env SERVICE_PORT=8080 \
       --env SERVICE_PATH=&quot;/simpleservicediscovery&quot; \
       --env PUBLISH_HOST=&quot;glassfish.docker.ahf&quot; \
       --env PUBLISH_IP=&quot;$SERVER_ADDRESS&quot; \
       --env PUBLISH_INTERVAL=&quot;1.0&quot; \
       --name python-ws-discovery-server \
       python-ws-discovery-server
docker run \
       --rm \
       --network mcast_net \
       --ip 192.168.0.122 \
       --env TIMEOUT=&quot;2.0&quot; \
       --name python-ws-discovery-client \
       python-ws-discovery-client</pre>
[Optional] Re-enable packet forwarding.

<pre>sudo sysctl net.ipv4.conf.all.forwarding=1</pre>
== Two resin devices ==

[Optional] Remove the Docker networks.

<pre>docker -H tcp://resin1.local:2375 network rm mcast_net
docker -H tcp://resin2.local:2375 network rm mcast_net</pre>
[Optional] Create the networks.

<pre>docker -H tcp://resin1.local:2375 network create \
                         -d macvlan \
                         --subnet=192.168.0.0/24 \
                         --gateway=192.168.0.1 \
                         -o parent=eth0 \
                         mcast_net
docker -H tcp://resin2.local:2375 network create \
                         -d macvlan \
                         --subnet=192.168.0.0/24 \
                         --gateway=192.168.0.1 \
                         -o parent=eth0 \
                         mcast_net</pre>
Build the images.

<pre>docker -H tcp://resin1.local:2375 build \
                    --tag python-ws-discovery-server core/
docker -H tcp://resin2.local:2375 build \
                    --tag python-ws-discovery-client client/</pre>
Run the containers.

<pre>SERVER_ADDRESS=$(ping resin1.local -c 1 | sed -n 1p | cut -d&quot;(&quot; -f2 | cut -d&quot;)&quot; -f1)
[ -n &quot;SERVER_ADDRESS&quot; ] &amp;&amp; \
docker -H &quot;tcp://$SERVER_ADDRESS:2375&quot; run \
                   --rm \
                   --network mcast_net \
                   --ip 192.168.0.121 \
                   --env SERVICE_TYPE=&quot;http&quot; \
                   --env SERVICE_PORT=8080 \
                   --env SERVICE_PATH=&quot;/simpleservicediscovery&quot; \
                   --env PUBLISH_HOST=&quot;glassfish.docker.ahf&quot; \
                   --env PUBLISH_IP=&quot;$SERVER_ADDRESS&quot; \
                   --env PUBLISH_INTERVAL=&quot;1.0&quot; \
                   --name python-ws-discovery-server \
                   python-ws-discovery-server
docker -H tcp://resin2.local:2375 run \
                   --rm \
                   --network mcast_net \
                   --ip 192.168.0.122 \
                   --env TIMEOUT=&quot;2.0&quot; \
                   --name python-ws-discovery-client \
                   python-ws-discovery-client</pre>
== Third-party licensing ==

Full licenses under <code>LICENSES-3rd</code>.

=== python-ws-discovery ===

* Source code: https://github.com/andreikop/python-ws-discovery
* License: GNU Lesser General Public License v3.0
* Attributions
* Andrei Kopats
* Pieter Jordaan
* L.A. Fernando

