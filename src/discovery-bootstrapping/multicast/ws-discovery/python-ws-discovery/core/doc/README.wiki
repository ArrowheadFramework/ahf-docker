= ws-discovery-server =

Server-side of the Python implementation of service discovery bootstrapping through WS-Discovery.

== Usage ==

<pre>docker build -t ws-discovery-server .
docker run \
        --rm \
        --network host \
        --env SERVICE_TYPE=&quot;http&quot; \
        --env SERVICE_PORT=8080 \
        --env SERVICE_PATH=&quot;/simpleservicediscovery&quot; \
        --env PUBLISH_HOST=&quot;glassfish.docker.ahf&quot; \
        --env PUBLISH_INTERVAL=&quot;1.0&quot; \
        --name ws-discovery-server \
        ws-discovery-server</pre>
== Environment variables ==

=== SERVICE_TYPE ===

Represents the type of service that we are publishing. Generally it will be one of <code>http</code>, <code>https</code> or <code>coap</code>, but others might be used. Most likely, the client will use it as the ''scheme'' part of a URI, so keep this in mind. It is, however, still the responsibility of the client to handle this correctly.

'''No default'''. The container will print an error and exit if no value is given.

=== SERVICE_PORT ===

Represents the port of the service to be published.

'''No default'''. The container will print an error and exit if no value is given.

=== SERVICE_PATH ===

Represents the relative path of the service to be published. It refers in the URI to the path section, where a URI is formed as follows:

<pre>scheme:[//[user[:password]@]host[:port]][/path][?query][#fragment]</pre>
'''No default'''. The container will print an error and exit if no value is given.

=== PUBLISH_HOST ===

The host for the service to be published.

'''No default'''. The value of <code>NETWORK_INTERFACE</code> will be used to get the container's IP if none is given. If neither variable has a value, the container will print an error and exit.

=== PUBLISH_IP ===

The IP address for the service to be published.

'''No default'''. The value of <code>NETWORK_INTERFACE</code> will be used to get the container's IP if none is given. If neither variable has a value, the container will print an error and exit.

=== NETWORK_INTERFACE ===

The network interface from which to pull the current IP to be published if none is given in <code>PUBLISH_ADDR</code>.

'''Default''': <code>eth0</code>. This is the default interface for containers in Docker.

Please note that if the container's IP is published, the IP address will only work in single-host environments unless a network driver other than the default (<code>bridge</code>), such as <code>host</code> or <code>macvlan</code> is used.

* When using <code>host</code>, ensure that the <code>NETWORK_INTERFACE</code> value given is the name of an interface found on the actual host (e.g. as obtained from <code>ip address</code>).
* When using <code>macvlan</code>, consider that the IP address given using <code>--ip</code> when running the container is the one that will be published. Unless that somehow is the same that can be used to connect to the actual service (Service Registry), you should use <code>PUBLISH_ADDR</code>.

== Using Macvlan ==

In case you prefer not to use <code>--network host</code>, you may use a macvlan network driver which should allow you to perform multicast from Docker if your engine supports it.

The network interface information should be acquired by using your operating system's tools (e.g. <code>ip address</code>)

<ul>
<li><p>Remove the network if you have done this before and want to reconfigure, otherwise skip.</p>
<pre>docker network rm mcast_net</pre></li>
<li><p>Create the network (get the information from your OS). The name of the network is <code>mcast_net</code>, you may change that to anything you prefer.</p>
<pre>docker network create -d macvlan \
        -o parent=eth0 \
        --subnet=192.168.0.0/24 \
        --gateway=192.168.0.1 \
        mcast_net</pre></li>
<li><p>Re-build the container if necessary (note that the build step is independent of the network you will use when running it).</p>
<pre>docker build -t ws-discovery-server .   </pre></li>
<li><p>Run the container selecting the created network and an IP which falls under the correct network segment (e.g. your current IP + 10).</p>
<pre>IP_ADDRESS=$(ip route get 1 | awk '{print $NF;exit}')
docker run \
    --rm \
    --network mcast_net \
    --ip 192.168.0.121 \
    --env SERVICE_TYPE=&quot;http&quot; \
    --env SERVICE_PORT=8080 \
    --env SERVICE_PATH=&quot;/simpleservicediscovery&quot; \
    --env PUBLISH_HOST=&quot;glassfish.docker.ahf&quot; \
    --env PUBLISH_IP=&quot;$IP_ADDRESS&quot; \
    --env PUBLISH_INTERVAL=&quot;1.0&quot; \
    --name ws-discovery-server \
    ws-discovery-server</pre></li></ul>

Above we get our public IP address and configure our container to publish that instead of the one we gave it using macvlan.

