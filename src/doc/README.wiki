= Arrowhead 3.0 Containers Source =

This document contains information on building the Arrowhead Framework 3.0 containers from scratch.

== Getting the source code ==

The easiest way, unless this other repository is removed, is to download the latest [https://forge.soa4d.org/anonscm/gitweb?p=arrowhead-f/users/docker.git;a=snapshot;h=refs/heads/3.0;sf=tgz snapshot of the docker.git] repository and extract it.

The following commands will do this for you (in Linux at least).

<pre>curl -k -o ahf-docker-3.0.tar.gz \
'https://forge.soa4d.org/anonscm/gitweb?p=arrowhead-f/users/docker.git;a=snapshot;h=refs/heads/3.0;sf=tgz'
mkdir -p ahf-docker-3.0
tar -xvf ahf-docker-3.0.tar.gz -C ahf-docker-3.0 --strip-component=1</pre>
== Instructions for users ==

=== Run ===

With GIT, Docker and Docker-Compose installed:

<pre>docker-compose --file core/docker-compose.yml -p &quot;ahf&quot; up --build &amp;&amp; \
docker-compose --file core/docker-compose.yml -p &quot;ahf&quot; down -v</pre>
=== Test ===

<pre>docker-compose --file soapui/docker-compose.yml -p &quot;ahf&quot; up --build &amp;&amp; \
docker-compose --file soapui/docker-compose.yml -p &quot;ahf&quot; down -v</pre>
=== Other commands ===

* To get the auto-generated TLS files, including the Certificate Authority certificate and key.

<!-- -->
<pre>sudo cp -far &quot;$(docker volume inspect ahf_tls | 
    grep Mountpoint | 
    sed -E 's/^\s*&quot;\w*&quot;\s*:\s*&quot;(.*)&quot;.*$/\1/g')/.&quot; . &amp;&amp; \
    sudo chown -R $USER:$USER .</pre>
<ul>
<li><p>To get the auto-generated TSIG file.</p>
<pre>sudo cp -far &quot;$(docker volume inspect ahf_tsig | 
grep Mountpoint | 
sed -E 's/^\s*&quot;\w*&quot;\s*:\s*&quot;(.*)&quot;.*$/\1/g')/.&quot; . &amp;&amp; \
sudo chown -R $USER:$USER .</pre></li></ul>

== Commands for developers ==

Build the images.

<pre>docker build -t arrowheadf/serviceregistry:3.0 core/bind
docker build -t arrowheadf/core:3.0 core/glassfish
docker build -t arrowheadf/simpleservicediscovery:3.0 core/simpleservicediscovery
docker build -t arrowheadf/tests:3.0 soapui</pre>
Push to Docker Hub. Requires to run <code>docker login</code> first.

<pre>docker push arrowheadf/serviceregistry:3.0
docker push arrowheadf/core:3.0
docker push arrowheadf/simpleservicediscovery:3.0
docker push arrowheadf/tests:3.0</pre>
